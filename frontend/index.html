<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>RicoBet Mascot Clicker</title>

<style>
  :root {
    --ink: #eef4ff;
    --muted: #9fa9d8;
    --accent: #ff6ec4;
    --accent2: #7873f5;
  }

  /* Background image */
  html, body {
    height:100%;
    margin:0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    color: var(--ink);
    background: #0b0b16 url("https://ricobr.ft-crm.com/media-api/serve/a02f364f-bea1-4a99-ae4c-211994eced91_2.png") center/cover no-repeat fixed;
  }
  body::before {
    content:"";
    position:fixed; inset:0;
    background: radial-gradient(transparent, rgba(0,0,0,.35));
    pointer-events:none;
  }

  /* Centered app wrapper */
  .app {
    position: relative;
    z-index: 1;
    max-width: 520px;
    margin: 0 auto;
    padding: 24px 16px 60px;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
  }

  h1 {
    width: 100%;
    font-size: 1.8rem;
    margin: 0 0 10px;
    text-align: left;
    background: linear-gradient(to right, var(--accent), var(--accent2));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  #tokenBox {
    display: flex; flex-direction: column; align-items: center;
    gap: 4px;
    margin-top: 4px;
  }
  #tokenCount {
    font-size: 2.2rem;
    font-weight: 700;
    color: #ffd86a;
  }

  #energyBar {
    width: 240px;
    height: 14px;
    border: 1px solid #7873f5;
    border-radius: 6px;
    overflow: hidden;
    margin: 12px auto 18px;
  }
  #energyFill {
    height: 100%;
    width: 0%;
    background: linear-gradient(to right, #ff6ec4, #7873f5);
    transition: width 0.25s linear;
  }

  /* Clean mascot: no background circle */
  #mascot {
    margin: 6px auto 12px;
    display: flex;
    align-items: center; justify-content: center;
    width: 180px; height: 180px;
    background: none; border: none; box-shadow: none;
    cursor: pointer;
  }
  #mascot img {
    width: 100%; height: 100%;
    object-fit: contain;
    user-select: none; pointer-events: none;
    transition: transform .08s ease;
  }
  #mascot:active img { transform: scale(.92); }

  .buttons { margin-top: 6px; }
  .btn {
    display: inline-block;
    background: linear-gradient(to right, var(--accent), var(--accent2));
    color: white;
    border: none;
    padding: 10px 18px;
    border-radius: 8px;
    font-weight: 600;
    margin: 6px 6px 0;
    cursor: pointer;
  }
  .btn:active { opacity: .7; }

  dialog {
    background: #161628;
    border: 1px solid #282844;
    border-radius: 10px;
    color: white;
    padding: 16px;
    max-width: 320px;
  }

  .toast {
    position: fixed;
    bottom: 18px; left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,.75);
    color: #fff;
    padding: 10px 16px;
    border-radius: 20px;
    font-size: 14px;
    z-index: 2;
    animation: fadeinout 2s;
  }
  @keyframes fadeinout {
    0% { opacity: 0; transform: translate(-50%,20px);}
    10%,90% { opacity: 1; transform: translate(-50%,0);}
    100% { opacity: 0; transform: translate(-50%,20px);}
  }
</style>
</head>
<body>

<div class="app">
  <h1>üê± RicoBet Mascot Clicker</h1>

  <div id="tokenBox">
    <div id="tokenCount">0</div>
    <div style="font-size:14px;color:var(--muted);">RicoBet Tokens</div>
  </div>

  <div id="energyBar"><div id="energyFill"></div></div>

  <div id="mascot">
    <img
      src="https://ricomx.ft-crm.com/media-api/serve/f457a1cb-76e8-4d4b-9bdc-01a29951a976_full"
      alt="Rico Mascot"
    />
  </div>

  <div class="buttons">
    <button class="btn" id="btnShop">Shop</button>
    <button class="btn" id="btnDaily">Daily</button>
    <button class="btn" id="btnCity">City</button>
  </div>
</div>

<!-- Dialogs -->
<dialog id="dlgShop">
  <h3>Shop</h3>
  <p><button class="btn" data-buy="tap">Upgrade Tap (+1 Power) ‚Äî 50</button></p>
  <p><button class="btn" data-buy="cap">Increase Energy Cap ‚Äî 80</button></p>
  <p><button class="btn" data-buy="regen">Regen Speed +0.5 ‚Äî 120</button></p>
  <p><button class="btn" data-buy="shirt">New Shirt ‚Äî 30</button></p>
  <p><button class="btn" data-buy="bg">Change Theme ‚Äî 60</button></p>
  <p><button data-close class="btn">Close</button></p>
</dialog>

<dialog id="dlgCity">
  <h3>Your City</h3>
  <div id="cityList"></div>
  <p><button class="btn" data-build="house">üè† Build House ‚Äî 150</button></p>
  <p><button class="btn" data-build="shop">üè¨ Build Shop ‚Äî 400</button></p>
  <p><button class="btn" data-build="tower">üèØ Build Tower ‚Äî 1200</button></p>
  <p><button data-close class="btn">Close</button></p>
</dialog>

<script>
/* ---------------- CONFIG ---------------- */
window.API_BASE = ''; // same-origin (served by Render)

/* Telegram WebApp init */
if (window.Telegram && Telegram.WebApp) {
  Telegram.WebApp.ready();
  Telegram.WebApp.expand();
}

const $ = (s)=>document.querySelector(s);
const tokenCount = $('#tokenCount');
const eFill = $('#energyFill');
const btnShop = $('#btnShop');
const btnDaily = $('#btnDaily');
const btnCity = $('#btnCity');
const dlgShop = $('#dlgShop');
const dlgCity = $('#dlgCity');

let STATE = {
  tokens: 0, energy: 100, cap: 100, level: 1, tap_power: 1,
  regen_per_sec: 1, last_tick: new Date().toISOString()
};

async function API(path, opt={}) {
  const base = window.API_BASE || '';
  const res = await fetch(base+path, {
    ...opt,
    headers: {
      ...(opt.headers||{}),
      'x-telegram-init': (window.Telegram?.WebApp?.initData || '')
    }
  });
  if (!res.ok) throw new Error(res.status);
  return res.json();
}

function showToast(msg) {
  const t = document.createElement('div');
  t.className = 'toast';
  t.textContent = msg;
  document.body.appendChild(t);
  setTimeout(()=>t.remove(),2000);
}

function render() {
  tokenCount.textContent = Math.floor(STATE.tokens).toLocaleString();
  const pct = Math.min(1, STATE.energy/STATE.cap);
  eFill.style.width = (pct*100).toFixed(1)+'%';
}

async function loadState() {
  try {
    const r = await API('/api/state');
    if(r.ok){ STATE = r.state; render(); }
  } catch(e) { console.error(e); }
}

$('#mascot').addEventListener('click', async ()=>{
  try {
    const r = await API('/api/tap', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({taps:1})
    });
    if(r.ok){ STATE = r.state; render(); }
    else showToast(r.error || 'No energy');
  } catch(e){ showToast('Error'); }
});

// Shop
btnShop.onclick = ()=>dlgShop.showModal();
dlgShop.addEventListener('click', async (e)=>{
  if(e.target.matches('[data-close]')) return dlgShop.close();
  const kind = e.target.getAttribute('data-buy');
  if(!kind) return;
  const r = await API('/api/buy', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({kind})
  });
  if(r.ok){ STATE = r.state; render(); showToast('Purchased '+kind); }
  else showToast(r.error);
});

// Daily
btnDaily.onclick = async ()=>{
  const r = await API('/api/daily',{method:'POST'});
  if(r.ok){ STATE = r.state; render(); showToast('Daily +'+r.reward); }
  else showToast(r.error);
};

// City
btnCity.onclick = ()=>dlgCity.showModal();
dlgCity.addEventListener('click', async (e)=>{
  if(e.target.matches('[data-close]')) return dlgCity.close();
  const b = e.target.getAttribute('data-build');
  if(!b) return;
  const r = await API('/api/build', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({building:b})
  });
  if(r.ok){ STATE = r.state; render(); showToast('Built '+b); }
  else showToast(r.error);
});

loadState();
</script>
</body>
</html>
